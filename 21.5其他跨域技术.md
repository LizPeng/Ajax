## 21.5 其他跨域技术

在CORS出现以前，要实现跨域Ajax通信颇费周折。开发人员相了一些办法，利用DOM中能够执行跨域请求的功能，在不依赖XHR对象的情况下也能发送某种请求。虽然CORS技术已经无处不在，但开发人员自己发明的这些技术仍然被广泛利用，毕竟这样不需要修改服务器端代码。


### 21.5.1 图像Ping

上述第一种跨域请求技术是使用<img>标签。我们知道，一个网页可以从任何网页中加载图像，不用担心跨域不跨域。这也是在线广告跟踪浏览量的主要方式。正如第13张讨论过的，也可以动态地地建图像，使用它们的onload和onerror事件处理程序来确定是否接收到了响应。

动态创建图像经常用于图像Ping。图片Ping是与服务器进行简单、单向的跨域通信的一种方式。请求的数据是通过查询字符串形式发送的，而响应可以是任意内容，但通常是像素图或204响应。通过图像Ping，浏览器得不到任何具体的数据，但是通过侦听load和error事件，它能知道响应时什么时候接收到的。来看下面的例子。

    var img = new Image();
    img.onload = img.onerror = function(){
    	alert("Done!")
    }
    img.src = "http://www.example.com/test?name=Nicholas";

这里创建了一个Image的实例，然后将onload和onerror事件处理程序指定为同一个函数。这样无论是什么响应，只要请求完成，就能得到通知。请求从设置src属性那一刻开始，而这个例子在请求中发送了一个name参数。

图像Ping最常用于跟踪用户点击页面或动态广告曝光次数。图像Ping有两个主要的缺点，一是只能发送GET请求，二十无法访问服务器的响应文本。因此，图像Ping只能用于浏览器与服务器间的单向通信。